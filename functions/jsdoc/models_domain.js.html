<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/domain.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/domain.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.scheduledDomains = exports.updateDomains = exports.deleteDomains = exports.createDomains = void 0;
const functions = require("firebase-functions");
const domains_create_chain_1 = require("../chains/domains/domains_create_chain");
const domains_delete_chain_1 = require("../chains/domains/domains_delete_chain");
const domains_update_chain_1 = require("../chains/domains/domains_update_chain");
const domains_schedule_chain_1 = require("../chains/domains/domains_schedule_chain");
/**
 * Domain Module used to create domain,
 *  update domain, delete domain and schedule domain
 * @module domain
 */
/**
 *
 * @param createDomains - Helps to create domains
 *
 */
exports.createDomains = functions.firestore
    .document("domains/{docId}")
    .onCreate(async (snap, context) => {
    try {
        const a = new domains_create_chain_1.default(snap);
        const b = await (await a.updateSnapshot()).updateDependency();
        await (await b.notify()).updateAngolia().then(() => {
            console.log("Domain created successfully");
            return null;
        });
    }
    catch (err) {
        console.log(err);
        return;
    }
});
/**
 * @param deleteDomains
 */
exports.deleteDomains = functions.firestore
    .document("domains/{docId}")
    .onDelete(async (snap, context) => {
    try {
        const deleteDomainChain = new domains_delete_chain_1.default(snap);
        await (await (await deleteDomainChain.updateDependency())
            .notify()).updateAngolia().then(() => {
            console.log("Domain deleted successfully");
            return;
        });
    }
    catch (err) {
        console.log(err);
        return;
    }
    return;
});
/**
 * This helps to update domain to the database...
 * it is dependent on DomainsUpdateChain class
 *
 * @param updateDomains
 */
exports.updateDomains = functions.firestore
    .document("domains/{docId}")
    .onUpdate(async (snap, context) => {
    try {
        const updateDomainChain = new domains_update_chain_1.default(snap);
        const status = await (await updateDomainChain
            .verifyIfDocIsEdited()).objectStatus;
        if (status === false) {
            return;
        }
        await (await (await updateDomainChain.updateSnapshot())
            .notify()).updateAngolia().then(() => {
            console.log("Domain Updated Successfully");
            return;
        });
    }
    catch (err) {
        console.log(err);
        return null;
    }
    return;
});
/**
 * @param scheduledDomains
 */
exports.scheduledDomains = functions.pubsub.schedule("0 11 * * *")
    .onRun(async (context) => {
    try {
        await (await (await new domains_schedule_chain_1.default()
            .fetchExpiringDomainSnapshot())
            .updateAlreadyExpiredDomain())
            .notify().then(() => {
            console.log("scheduled domain cronjob is completed");
        });
    }
    catch (err) {
        console.log(err);
        return;
    }
    return null;
});
//# sourceMappingURL=domain.js.map</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-domain.html">domain</a></li></ul><h3>Classes</h3><ul><li><a href="DomainsCreateChain.html">DomainsCreateChain</a></li><li><a href="DomainsDeleteChain.html">DomainsDeleteChain</a></li><li><a href="DomainsScheduleChain.html">DomainsScheduleChain</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu Aug 26 2021 23:57:18 GMT+0100 (West Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
